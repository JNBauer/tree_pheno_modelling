---
bibliography: libs/references.bib
link-citations: TRUE
output: 
  html_document
---

## Lesson 09: Getting temperature data
\
**1.Choose a location of interest and find the 25 closest weather stations using the handle_gsod function**

I chose a location with the latitude `32`, which can be seen in the leaflet below.
```{r Leaflet of selected location, echo=FALSE, message=FALSE}
require(leaflet) 
m <- leaflet() %>% setView(lng = 18.93521767626777 , lat = -34.10835247406239, zoom = 16)
m %>% addProviderTiles(providers$Esri.WorldImagery) %>%
  addMiniMap(
    tiles = providers$Esri.WorldStreetMap,
    toggleDisplay = TRUE)

require(chillR)
library(kableExtra)
```

```{r Creating station list with handle_gsod, message=FALSE, warning=FALSE, eval=FALSE}
station_list<-handle_gsod(action="list_stations",
                          location=c(18.93521767626777, -34.10835247406239),
                          time_interval=c(1977,2020),
                          stations_to_choose_from = 25)
```

```{r Create table for station list, echo=FALSE}
station_list <- read.csv(file = "data/station_list.csv")
kbl(station_list[1:10,], escape = F) %>%
  kable_paper("hover", full_width = F, position = "left")
```

\
**2.Download weather data for the most promising station on the list**

Selecting the 3th station of the search query from task 1.
```{r Download with weather for location with station list, eval=FALSE}
downloaded_weather<-handle_gsod(action="download_weather",
                     location=station_list$chillR_code[3],
                     time_interval=c(1977,2020))
```

\
**3.Convert the weather data into chillR format**

```{r Clean weather data with handle_gsod, eval=FALSE}
cleaned_weather<-handle_gsod(downloaded_weather)
```

```{r Create table with cleaned weather, echo=FALSE}
cleaned_weather <- read.csv(file = "data/CapeTown_chillR_weather.csv")
kbl(head(cleaned_weather), escape = F) %>%
  kable_paper("hover", full_width = F, position = "left")
```

```{r Save station list and weather as CSV in /data, echo=FALSE, eval=TRUE}
write.csv(station_list,"data/station_list.csv",row.names=FALSE)
#write.csv(weather,"data/CapeTown_weather.csv",row.names=FALSE)
write.csv(cleaned_weather$`CAPE TOWN INTL`$weather,"data/CapeTown_chillR_weather.csv",row.names=FALSE)
```